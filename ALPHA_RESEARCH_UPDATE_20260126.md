# Alpha Research Update: Resolving The "Missing Trades" Mystery
> **Date**: 2026-01-26
> **Focus**: Discrepancy Resolution, Parameter Sensitivity, and Infrastructure Hardening

此文件記錄了 Grid Search (28 筆交易) 與 Report (6 筆交易) 巨大差異的調查過程與最終解決方案。

## 1. 核心問題 (The Problem)
*   **症狀**：即使使用相同的模型 (`v2.2.1`) 與數據，Grid Search 報告顯示 28 筆交易，但 `scripts/report.py` 生成的報告僅有 6~8 筆。
*   **影響**：無法信任 Report 的回測結果，導致優化方向迷失。

## 2. 調查與修復 (Investigation & Fixes)

### 2.1 Bug Fixes (基礎設施修復)
在深入參數之前，我們發現並修復了兩個嚴重的基礎設施問題，雖然它們不是差異的主因，但嚴重影響了回測的正確性：
1.  **Backtest Warmup Slicing (`backtest.py`)**:
    *   **問題**: 舊程式碼在模擬開始前就將數據切片 (`slice`)，導致 EMA/ATR 等指標沒有足夠的 Warmup 數據，計算出錯誤數值（或 NaN）。
    *   **修復**: 移除了過早切片的邏輯，確保模擬器能讀取到完整的歷史數據。
2.  **Stale Data (`engine.py`)**:
    *   **問題**: Report 腳本只讀取 DB 舊資料，沒有像 Grid Search 那樣去拉取最新行情。
    *   **修復**: 整合了 `fetch_yearly_ohlcv` 之 Smart Sync 機制，每次跑報表前自動同步最新 K 線。

### 2.2 Root Cause Analysis (根源分析)
修復上述 Bug 後，交易次數僅微幅上升至 8 筆。真正的差異來源被證實為 **參數敏感度 (Parameter Sensitivity)**：

*   **Grid Search**: 暴力搜尋了 `trigger_threshold` [0.6, 0.7, 0.8] 和 `bb_std` [1.8, 2.0, 2.2]。其 "Best Result" (28 trades) 極大機率是來自寬鬆組合 (**Trigger=0.6 / BB=2.0**)。
*   **Report Defaults**: 透過 `engine.py` 硬編碼，強制使用了最嚴格組合 (**Trigger=0.8 / BB=2.2**)。

**驗證**：
將 Report 參數暫時調降為 `Trigger=0.6` 後，交易次數瞬間回升至 18 筆，證實了模型對 `trigger_threshold` 高度敏感。

## 3. 指標定義回顧 (Metric Definitions)
為了精確微調，我們重新確立了關鍵參數的定義：
*   **ATR (Average True Range)**: 波動率絕對值。`Trailing Mult=3` 代表停損設在 3 倍平日波動之外，過濾雜訊。
*   **ADX (Average Directional Index)**: 趨勢強度。`ADX > 20` 代表趨勢成形，避免在盤整泥淖中被雙巴。

## 4. 下一步計畫 (Next Steps: Interaction)
鑑於參數對結果影響巨大，靜態報表 (Static HTML) 已不足以滿足需求。
*   **新方向**: 開發 **Interactive Web UI (方案 2)**。
*   **功能**:
    *   Web 介面 (FastAPI + React/Simple JS)。
    *   提供 Slider 滑桿即時調整 `Trigger`, `BB Std`, `Stop Loss`。
    *   後端即時重跑 Backtest (約 0.5s) 並更新圖表。
    *   解決「靜態檔案過大」與「參數盲測」的雙重痛點。

---
*Generated by Antigravity Agent*
